<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Dashboard</title>

    {% load static %}
    <link rel="stylesheet" href="{% static 'css/user_dashboard.css' %}">
</head>
<body>

<div class="dashboard-container">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            Turf Booking
        </div>

        <nav class="sidebar-nav">
            <a class="active">Dashboard</a>
            <a href="{% url 'my_bookings' %}">My Bookings</a>
            <a href="{% url 'logout' %}" class="logout">Logout</a>
        </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="dashboard-main">

        <!-- HEADER -->
        <div class="dashboard-header">
            <h1>User Dashboard</h1>
            <span>Welcome, <strong>{{ request.user.username }}</strong></span>
        </div>

        <!-- OVERVIEW -->
        <section class="overview">
            <div class="overview-card">
                <h2>{{ total_bookings }}</h2>
                <p>Total Bookings</p>
            </div>

            <div class="overview-card">
                <h2>{{ upcoming_bookings }}</h2>
                <p>Upcoming</p>
            </div>

            <div class="overview-card">
                <h2>{{ completed_bookings }}</h2>
                <p>Completed</p>
            </div>
        </section>

        <!-- FIND TURFS -->
        <section class="dashboard-section active">

            <h2>Find Turfs</h2>

            <form method="get" style="margin: 20px 0;">
                <div style="display:flex; gap:20px; max-width:600px;">
                  <select name="district" id="districtSelect">
                    <option value="">Select District</option>
                        {% for d in districts %}
                            <option value="{{ d.id }}"
                                {% if d.id|stringformat:"s" == selected_district %}selected{% endif %}>
                                {{ d.name }}
                            </option>
                        {% endfor %}
                 </select>

                   <select name="location" id="locationSelect">
                        <option value="">Select Location</option>
                        {% for l in locations %}
                            <option value="{{ l.id }}"
                                {% if l.id|stringformat:"s" == selected_location %}selected{% endif %}>
                                {{ l.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </form>

            <!-- TURF CARDS -->
            <div class="card-grid">

                {% for turf in turfs %}
                <div class="card">
                    <h3>{{ turf.name }}</h3>
                    <p>{{ turf.location.name }} ({{ turf.location.district.name }})</p>

                    <a class="link" href="{% url 'turf_slots' turf.id %}">
                        View Slots â†’
                    </a>
                </div>
                {% empty %}
                <p>No turfs found.</p>
                {% endfor %}

            </div>

        </section>

    </main>

</div>
<script>
document.getElementById("districtSelect").addEventListener("change", function () {
    const districtId = this.value;
    if (districtId) {
        window.location.href = "?district=" + districtId;
    }
});
</script>
<script>
document.getElementById("locationSelect").addEventListener("change", function () {
    const district = document.getElementById("districtSelect").value;
    const location = this.value;

    let url = "?";

    if (district) {
        url += "district=" + district;
    }

    if (location) {
        url += "&location=" + location;
    }

    window.location.href = url;
});
</script>
</body>
</html>